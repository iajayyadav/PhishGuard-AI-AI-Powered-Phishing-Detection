<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Phishing Detector</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>

    <div class="container">
        <div class="theme-switch-wrapper">
            <label class="theme-switch" for="theme-toggle">
                <input type="checkbox" id="theme-toggle" />
                <span class="slider"></span>
            </label>
        </div>
        
        <div class="header-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75m-3-7.036A11.959 11.959 0 0 1 3.598 6 11.99 11.99 0 0 0 3 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285Z" />
            </svg>
        </div>

        <h1>AI Phishing Detector</h1>
        <p>Enter a URL to analyze it for potential phishing risks.</p>

        <form id="analyze-form" class="form-group">
            <input type="text" id="url-input" name="url" placeholder="https://example.com" required>
            <button type="submit" id="submit-button">
                <span class="button-text">Analyze</span>
                <div class="spinner hidden"></div>
            </button>
        </form>

        <div id="result-container" class="result-box hidden">
            </div>
    </div>

    <script>
        // --- SVG Icons ---
        const successIcon = `
            <svg class="result-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
            </svg>`;
        
        const errorIcon = `
            <svg class="result-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z" />
            </svg>`;

        // --- Element References ---
        const form = document.getElementById("analyze-form");
        const urlInput = document.getElementById("url-input");
        const submitButton = document.getElementById("submit-button");
        const buttonText = document.querySelector(".button-text");
        const spinner = document.querySelector(".spinner");
        const resultContainer = document.getElementById("result-container");

        // === NEW: Theme Toggle Logic ===
        const themeToggle = document.getElementById("theme-toggle");

        // 1. Function to apply the theme and save preference
        function applyTheme(theme) {
            if (theme === 'light') {
                document.body.classList.add("light-mode");
            } else {
                document.body.classList.remove("light-mode");
            }
            localStorage.setItem('theme', theme);
        }

        // 2. Add listener to the toggle
        themeToggle.addEventListener("change", (e) => {
            applyTheme(e.target.checked ? 'light' : 'dark');
        });

        // 3. On page load, check for saved theme
        (function () {
            const savedTheme = localStorage.getItem('theme') || 'dark'; // Default to dark
            applyTheme(savedTheme);
            if (savedTheme === 'light') {
                themeToggle.checked = true;
            }
        })();
        // === END: Theme Toggle Logic ===


        form.addEventListener("submit", async (e) => {
            e.preventDefault(); 
            submitButton.disabled = true;
            buttonText.classList.add("hidden");
            spinner.classList.remove("hidden");
            resultContainer.classList.add("hidden");
            resultContainer.classList.remove("success", "error"); 

            const formData = new FormData(form);

            try {
                const response = await fetch("/analyze", {
                    method: "POST",
                    body: formData
                });
                const data = await response.json();

                if (!response.ok || data.error) {
                    throw new Error(data.error || "An unknown error occurred.");
                }
                displaySuccess(data);

            } catch (err) {
                displayError(err.message);
            } finally {
                submitButton.disabled = false;
                buttonText.classList.remove("hidden");
                spinner.classList.add("hidden");
            }
        });

        function displaySuccess(data) {
            const { isPhishing, confidenceScore, explanation } = data;
            
            const title = isPhishing ? "Likely Phishing" : "Likely Safe";
            const icon = isPhishing ? errorIcon : successIcon;
            const resultClass = isPhishing ? "error" : "success";

            resultContainer.innerHTML = `
                <div class="result-header">
                    ${icon}
                    <h2 class="result-title">${title}</h2>
                </div>
                <div class="result-item">
                    <strong>Confidence Score:</strong>
                    <span>${confidenceScore}%</span>
                </div>
                <div class="result-item">
                    <strong>Explanation:</strong>
                    <span>${explanation}</span>
                </div>
            `;
            
            resultContainer.classList.add(resultClass);
            resultContainer.classList.remove("hidden");
        }

        function displayError(message) {
            resultContainer.innerHTML = `
                <div class="result-header">
                    ${errorIcon}
                    <h2 class="result-title">Analysis Failed</h2>
                </div>
                <div class="result-item">
                    <strong>Details:</strong>
                    <span>${message}</span>
                </div>
            `;
            resultContainer.classList.add("error");
            resultContainer.classList.remove("hidden");
        }
    </script>
</body>
</html>